<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/rvagg/node-worker-farm">worker-farm (v1.3.1)</a>
</h1>
<h4>Distribute processing tasks to child processes with an Ã¼ber-simple API and baked-in durability &amp; custom concurrency options.</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.worker-farm">module worker-farm</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.worker-farm">
            function <span class="apidocSignatureSpan"></span>worker-farm
            <span class="apidocSignatureSpan">(options, path, methods)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.end">
            function <span class="apidocSignatureSpan">worker-farm.</span>end
            <span class="apidocSignatureSpan">(api, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm">
            function <span class="apidocSignatureSpan">worker-farm.</span>farm
            <span class="apidocSignatureSpan">(options, path)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">worker-farm.</span>farm.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.worker-farm.farm">module worker-farm.farm</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.farm">
            function <span class="apidocSignatureSpan">worker-farm.</span>farm
            <span class="apidocSignatureSpan">(options, path)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.TimeoutError">
            function <span class="apidocSignatureSpan">worker-farm.farm.</span>TimeoutError
            <span class="apidocSignatureSpan">(message, cause)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.worker-farm.farm.prototype">module worker-farm.farm.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.prototype.addCall">
            function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>addCall
            <span class="apidocSignatureSpan">(call)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.prototype.childKeys">
            function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>childKeys
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.prototype.childTimeout">
            function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>childTimeout
            <span class="apidocSignatureSpan">(childId)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.prototype.end">
            function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>end
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.prototype.mkhandle">
            function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>mkhandle
            <span class="apidocSignatureSpan">(method)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.prototype.onExit">
            function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>onExit
            <span class="apidocSignatureSpan">(childId)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.prototype.processQueue">
            function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>processQueue
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.prototype.receive">
            function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>receive
            <span class="apidocSignatureSpan">(data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.prototype.send">
            function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>send
            <span class="apidocSignatureSpan">(childId, call)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.prototype.setup">
            function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>setup
            <span class="apidocSignatureSpan">(methods)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.prototype.startChild">
            function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>startChild
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.worker-farm.farm.prototype.stopChild">
            function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>stopChild
            <span class="apidocSignatureSpan">(childId)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.worker-farm" id="apidoc.module.worker-farm">module worker-farm</a></h1>


    <h2>
        <a href="#apidoc.element.worker-farm.worker-farm" id="apidoc.element.worker-farm.worker-farm">
        function <span class="apidocSignatureSpan"></span>worker-farm
        <span class="apidocSignatureSpan">(options, path, methods)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function farm(options, path, methods) {
  if (typeof options == 'string') {
    methods = path
    path = options
    options = {}
  }

  var f   = new Farm(options, path)
    , api = f.setup(methods)

  farms.push({ farm: f, api: api })

  // return the public API
  return api
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.end" id="apidoc.element.worker-farm.end">
        function <span class="apidocSignatureSpan">worker-farm.</span>end
        <span class="apidocSignatureSpan">(api, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function end(api, callback) {
  for (var i = 0; i &lt; farms.length; i++)
    if (farms[i] &amp;&amp; farms[i].api === api)
      return farms[i].farm.end(callback)
  process.nextTick(callback.bind(null, 'Worker farm not found!'))
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  , workers    = workerFarm(require.resolve('./child'))
  , ret        = 0

for (var i = 0; i &lt; 10; i++) {
  workers('#' + i + ' FOO', function (err, outp) {
    console.log(outp)
    if (++ret == 10)
      workerFarm.<span class="apidocCodeKeywordSpan">end</span>(workers)
  })
}
```

We'll get an output something like the following:

```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm" id="apidoc.element.worker-farm.farm">
        function <span class="apidocSignatureSpan">worker-farm.</span>farm
        <span class="apidocSignatureSpan">(options, path)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Farm(options, path) {
  this.options     = extend(DEFAULT_OPTIONS, options)
  this.path        = path
  this.activeCalls = 0
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.worker-farm.farm" id="apidoc.module.worker-farm.farm">module worker-farm.farm</a></h1>


    <h2>
        <a href="#apidoc.element.worker-farm.farm.farm" id="apidoc.element.worker-farm.farm.farm">
        function <span class="apidocSignatureSpan">worker-farm.</span>farm
        <span class="apidocSignatureSpan">(options, path)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function Farm(options, path) {
  this.options     = extend(DEFAULT_OPTIONS, options)
  this.path        = path
  this.activeCalls = 0
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm.TimeoutError" id="apidoc.element.worker-farm.farm.TimeoutError">
        function <span class="apidocSignatureSpan">worker-farm.farm.</span>TimeoutError
        <span class="apidocSignatureSpan">(message, cause)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">TimeoutError = function (message, cause) {
  init.call(this, type, message, cause)
  //TODO: the specificity here is stupid, errno should be available everywhere
  if (type == 'FilesystemError') {
    this.code    = this.cause.code
    this.path    = this.cause.path
    this.errno   = this.cause.errno
    this.message =
      (errno.errno[this.cause.errno]
        ? errno.errno[this.cause.errno].description
        : this.cause.message)
      + (this.cause.path ? ' [' + this.cause.path + ']' : '')
  }
  Error.call(this)
  if (Error.captureStackTrace)
    Error.captureStackTrace(this, arguments.callee)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.worker-farm.farm.prototype" id="apidoc.module.worker-farm.farm.prototype">module worker-farm.farm.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.worker-farm.farm.prototype.addCall" id="apidoc.element.worker-farm.farm.prototype.addCall">
        function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>addCall
        <span class="apidocSignatureSpan">(call)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">addCall = function (call) {
  if (this.ending)
    return this.end() // don't add anything new to the queue
  this.callQueue.push(call)
  this.processQueue()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    var args = Array.prototype.slice.call(arguments)
    if (this.activeCalls &gt;= this.options.maxConcurrentCalls) {
      var err = new MaxConcurrentCallsError('Too many concurrent calls (' + this.activeCalls + ')')
      if (typeof args[args.length - 1] == 'function')
        return process.nextTick(args[args.length - 1].bind(null, err))
      throw err
    }
    this.<span class="apidocCodeKeywordSpan">addCall</span>({
        method   : method
      , callback : args.pop()
      , args     : args
      , retries  : 0
    })
  }.bind(this)
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm.prototype.childKeys" id="apidoc.element.worker-farm.farm.prototype.childKeys">
        function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>childKeys
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">childKeys = function () {
  var cka = Object.keys(this.children)
    , cks

  if (this.searchStart &gt;= cka.length - 1)
    this.searchStart = 0
  else
    this.searchStart++

  cks = cka.splice(0, this.searchStart)

  return cka.concat(cks)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  if (!this.callQueue.length)
    return this.ending &amp;&amp; this.end()

  if (this.activeChildren &lt; this.options.maxConcurrentWorkers)
    this.startChild()

  for (cka = this.<span class="apidocCodeKeywordSpan">childKeys</span>(); i &lt; cka.length; i++) {
    childId = +cka[i]
    if (this.children[childId].activeCalls &lt; this.options.maxConcurrentCallsPerWorker
  &amp;&amp; this.children[childId].calls.length &lt; this.options.maxCallsPerWorker) {

this.send(childId, this.callQueue.shift())
if (!this.callQueue.length)
  return this.ending &amp;&amp; this.end()
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm.prototype.childTimeout" id="apidoc.element.worker-farm.farm.prototype.childTimeout">
        function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>childTimeout
        <span class="apidocSignatureSpan">(childId)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">childTimeout = function (childId) {
  var child = this.children[childId]
    , i

  if (!child)
    return

  for (i in child.calls) {
    this.receive({
        idx   : i
      , child : childId
      , args  : [ new TimeoutError('worker call timed out!') ]
    })
  }
  this.stopChild(childId)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm.prototype.end" id="apidoc.element.worker-farm.farm.prototype.end">
        function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>end
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">end = function (callback) {
  var complete = true
  if (this.ending === false)
    return
  if (callback)
    this.ending = callback
  else if (this.ending == null)
    this.ending = true
  Object.keys(this.children).forEach(function (child) {
    if (!this.children[child])
      return
    if (!this.children[child].activeCalls)
      this.stopChild(child)
    else
      complete = false
  }.bind(this))

  if (complete &amp;&amp; typeof this.ending == 'function') {
    process.nextTick(function () {
      this.ending()
      this.ending = false
    }.bind(this))
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  , workers    = workerFarm(require.resolve('./child'))
  , ret        = 0

for (var i = 0; i &lt; 10; i++) {
  workers('#' + i + ' FOO', function (err, outp) {
    console.log(outp)
    if (++ret == 10)
      workerFarm.<span class="apidocCodeKeywordSpan">end</span>(workers)
  })
}
```

We'll get an output something like the following:

```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm.prototype.mkhandle" id="apidoc.element.worker-farm.farm.prototype.mkhandle">
        function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>mkhandle
        <span class="apidocSignatureSpan">(method)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">mkhandle = function (method) {
  return function () {
    var args = Array.prototype.slice.call(arguments)
    if (this.activeCalls &gt;= this.options.maxConcurrentCalls) {
      var err = new MaxConcurrentCallsError('Too many concurrent calls (' + this.activeCalls + ')')
      if (typeof args[args.length - 1] == 'function')
        return process.nextTick(args[args.length - 1].bind(null, err))
      throw err
    }
    this.addCall({
        method   : method
      , callback : args.pop()
      , args     : args
      , retries  : 0
    })
  }.bind(this)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
}.bind(this)
}

// a constructor of sorts
Farm.prototype.setup = function (methods) {
var iface
if (!methods) { // single-function export
  iface = this.<span class="apidocCodeKeywordSpan">mkhandle</span>()
} else { // multiple functions on the export
  iface = {}
  methods.forEach(function (m) {
    iface[m] = this.mkhandle(m)
  }.bind(this))
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm.prototype.onExit" id="apidoc.element.worker-farm.farm.prototype.onExit">
        function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>onExit
        <span class="apidocSignatureSpan">(childId)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">onExit = function (childId) {
  // delay this to give any sends a chance to finish
  setTimeout(function () {
    var doQueue = false
    if (this.children[childId] &amp;&amp; this.children[childId].activeCalls) {
      this.children[childId].calls.forEach(function (call, i) {
        if (!call) return
        else if (call.retries &gt;= this.options.maxRetries) {
          this.receive({
              idx   : i
            , child : childId
            , args  : [ new ProcessTerminatedError('cancel after ' + call.retries + ' retries!') ]
          })
        } else {
          call.retries++
          this.callQueue.unshift(call)
          doQueue = true
        }
      }.bind(this))
    }
    this.stopChild(childId)
    doQueue &amp;&amp; this.processQueue()
  }.bind(this), 10)
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        , activeCalls : 0
        , exitCode    : null
      }

  forked.child.on('message', this.receive.bind(this))
  forked.child.once('exit', function (code) {
    c.exitCode = code
    this.<span class="apidocCodeKeywordSpan">onExit</span>(id)
  }.bind(this))

  this.activeChildren++
  this.children[id] = c
}

// stop a worker, identified by id
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm.prototype.processQueue" id="apidoc.element.worker-farm.farm.prototype.processQueue">
        function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>processQueue
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">processQueue = function () {
  var cka, i = 0, childId

  if (!this.callQueue.length)
    return this.ending &amp;&amp; this.end()

  if (this.activeChildren &lt; this.options.maxConcurrentWorkers)
    this.startChild()

  for (cka = this.childKeys(); i &lt; cka.length; i++) {
    childId = +cka[i]
    if (this.children[childId].activeCalls &lt; this.options.maxConcurrentCallsPerWorker
        &amp;&amp; this.children[childId].calls.length &lt; this.options.maxCallsPerWorker) {

      this.send(childId, this.callQueue.shift())
      if (!this.callQueue.length)
        return this.ending &amp;&amp; this.end()
    }<span class="apidocCodeCommentSpan"> /*else {
      console.log(
        , this.children[childId].activeCalls &lt; this.options.maxConcurrentCallsPerWorker
        , this.children[childId].calls.length &lt; this.options.maxCallsPerWorker
        , this.children[childId].calls.length , this.options.maxCallsPerWorker)
    }*/
</span>  }

  if (this.ending)
    this.end()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        call.retries++
        this.callQueue.unshift(call)
        doQueue = true
      }
    }.bind(this))
  }
  this.stopChild(childId)
  doQueue &amp;&amp; this.<span class="apidocCodeKeywordSpan">processQueue</span>()
}.bind(this), 10)
}

// start a new worker
Farm.prototype.startChild = function () {
this.childId++
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm.prototype.receive" id="apidoc.element.worker-farm.farm.prototype.receive">
        function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>receive
        <span class="apidocSignatureSpan">(data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">receive = function (data) {
  var idx     = data.idx
    , childId = data.child
    , args    = data.args
    , child   = this.children[childId]
    , call

  if (!child) {
    return console.error(
        'Worker Farm: Received message for unknown child. '
      + 'This is likely as a result of premature child death, '
      + 'the operation will have been re-queued.'
    )
  }

  call = child.calls[idx]
  if (!call) {
    return console.error(
        'Worker Farm: Received message for unknown index for existing child. '
      + 'This should not happen!'
    )
  }

  if (this.options.maxCallTime !== Infinity)
    clearTimeout(call.timer)

  if (args[0] &amp;&amp; args[0].$error == '$error') {
    var e = args[0]
    switch (e.type) {
      case 'TypeError': args[0] = new TypeError(e.message); break
      case 'RangeError': args[0] = new RangeError(e.message); break
      case 'EvalError': args[0] = new EvalError(e.message); break
      case 'ReferenceError': args[0] = new ReferenceError(e.message); break
      case 'SyntaxError': args[0] = new SyntaxError(e.message); break
      case 'URIError': args[0] = new URIError(e.message); break
      default: args[0] = new Error(e.message)
    }
    args[0].type = e.type
    args[0].stack = e.stack

    // Copy any custom properties to pass it on.
    Object.keys(e).forEach(function(key) {
      args[0][key] = e[key];
    });
  }

  process.nextTick(function () {
    call.callback.apply(null, args)
  })

  ;delete child.calls[idx]
  child.activeCalls--
  this.activeCalls--

  if (child.calls.length &gt;= this.options.maxCallsPerWorker
      &amp;&amp; !Object.keys(child.calls).length) {
    // this child has finished its run, kill it
    this.stopChild(childId)
  }

  // allow any outstanding calls to be processed
  this.processQueue()
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
// delay this to give any sends a chance to finish
setTimeout(function () {
  var doQueue = false
  if (this.children[childId] &amp;&amp; this.children[childId].activeCalls) {
    this.children[childId].calls.forEach(function (call, i) {
      if (!call) return
      else if (call.retries &gt;= this.options.maxRetries) {
        this.<span class="apidocCodeKeywordSpan">receive</span>({
            idx   : i
          , child : childId
          , args  : [ new ProcessTerminatedError('cancel after ' + call.retries + ' retries!') ]
        })
      } else {
        call.retries++
        this.callQueue.unshift(call)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm.prototype.send" id="apidoc.element.worker-farm.farm.prototype.send">
        function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>send
        <span class="apidocSignatureSpan">(childId, call)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">send = function (childId, call) {
  var child = this.children[childId]
    , idx   = child.calls.length

  child.calls.push(call)
  child.activeCalls++
  this.activeCalls++

  child.send({
      idx    : idx
    , child  : childId
    , method : call.method
    , args   : call.args
  })

  if (this.options.maxCallTime !== Infinity) {
    call.timer =
      setTimeout(this.childTimeout.bind(this, childId), this.options.maxCallTime)
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.children[id] = c
}

// stop a worker, identified by id
Farm.prototype.stopChild = function (childId) {
var child = this.children[childId]
if (child) {
  child.<span class="apidocCodeKeywordSpan">send</span>('die')
  setTimeout(function () {
    if (child.exitCode === null)
      child.child.kill('SIGKILL')
  }, this.options.forcedKillTime)
  ;delete this.children[childId]
  this.activeChildren--
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm.prototype.setup" id="apidoc.element.worker-farm.farm.prototype.setup">
        function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>setup
        <span class="apidocSignatureSpan">(methods)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">setup = function (methods) {
  var iface
  if (!methods) { // single-function export
    iface = this.mkhandle()
  } else { // multiple functions on the export
    iface = {}
    methods.forEach(function (m) {
      iface[m] = this.mkhandle(m)
    }.bind(this))
  }

  this.searchStart    = -1
  this.childId        = -1
  this.children       = {}
  this.activeChildren = 0
  this.callQueue      = []

  if (this.options.autoStart) {
    while (this.activeChildren &lt; this.options.maxConcurrentWorkers)
      this.startChild()
  }

  return iface
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm.prototype.startChild" id="apidoc.element.worker-farm.farm.prototype.startChild">
        function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>startChild
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">startChild = function () {
  this.childId++

  var forked = fork(this.path)
    , id     = this.childId
    , c      = {
          send        : forked.send
        , child       : forked.child
        , calls       : []
        , activeCalls : 0
        , exitCode    : null
      }

  forked.child.on('message', this.receive.bind(this))
  forked.child.once('exit', function (code) {
    c.exitCode = code
    this.onExit(id)
  }.bind(this))

  this.activeChildren++
  this.children[id] = c
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  this.childId        = -1
  this.children       = {}
  this.activeChildren = 0
  this.callQueue      = []

  if (this.options.autoStart) {
    while (this.activeChildren &lt; this.options.maxConcurrentWorkers)
      this.<span class="apidocCodeKeywordSpan">startChild</span>()
  }

  return iface
}

// when a child exits, check if there are any outstanding jobs and requeue them
Farm.prototype.onExit = function (childId) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.worker-farm.farm.prototype.stopChild" id="apidoc.element.worker-farm.farm.prototype.stopChild">
        function <span class="apidocSignatureSpan">worker-farm.farm.prototype.</span>stopChild
        <span class="apidocSignatureSpan">(childId)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">stopChild = function (childId) {
  var child = this.children[childId]
  if (child) {
    child.send('die')
    setTimeout(function () {
      if (child.exitCode === null)
        child.child.kill('SIGKILL')
    }, this.options.forcedKillTime)
    ;delete this.children[childId]
    this.activeChildren--
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      } else {
        call.retries++
        this.callQueue.unshift(call)
        doQueue = true
      }
    }.bind(this))
  }
  this.<span class="apidocCodeKeywordSpan">stopChild</span>(childId)
  doQueue &amp;&amp; this.processQueue()
}.bind(this), 10)
}

// start a new worker
Farm.prototype.startChild = function () {
this.childId++
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>